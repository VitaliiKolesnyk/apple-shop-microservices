{"ast":null,"code":"import { inject } from '@angular/core';\nimport { OrderService } from '../services/order.service';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { OidcSecurityService } from 'angular-auth-oidc-client';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nconst _c0 = (a0, a1) => ({\n  \"bg-red-200\": a0,\n  \"bg-white\": a1\n});\nconst _c1 = (a0, a1, a2) => ({\n  \"badge-success\": a0,\n  \"badge-warning\": a1,\n  \"badge-danger\": a2\n});\nfunction UserOrdersComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"strong\");\n    i0.ɵɵtext(2, \"Error:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMessage, \" \");\n  }\n}\nfunction UserOrdersComponent_div_16_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function UserOrdersComponent_div_16_div_17_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const order_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.cancellOrder(order_r4));\n    });\n    i0.ɵɵtext(2, \" Cancell \");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction UserOrdersComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"div\", 15)(2, \"h3\", 16);\n    i0.ɵɵtext(3, \"Order Number: \");\n    i0.ɵɵelementStart(4, \"span\", 17);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"span\", 18);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"p\")(9, \"strong\");\n    i0.ɵɵtext(10, \"Items Quantity:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"p\")(13, \"strong\");\n    i0.ɵɵtext(14, \"Total Amount:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15);\n    i0.ɵɵpipe(16, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(17, UserOrdersComponent_div_16_div_17_Template, 3, 0, \"div\", 19);\n    i0.ɵɵelementStart(18, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function UserOrdersComponent_div_16_Template_button_click_18_listener() {\n      const order_r4 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.openOrderDetails(order_r4.id));\n    });\n    i0.ɵɵtext(19, \"View Details\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const order_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(10, _c0, order_r4.status === \"CANCELLED\", order_r4.status !== \"CANCELLED\"));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(order_r4.orderNumber);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction3(13, _c1, order_r4.status === \"NEW\", order_r4.status === \"DELIVERED\", order_r4.status === \"CANCELLED\"));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\", order_r4.status, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", order_r4.quantity, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" $\", i0.ɵɵpipeBind2(16, 7, order_r4.totalAmount, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", order_r4.status !== \"CANCELLED\");\n  }\n}\nfunction UserOrdersComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 23)(1, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function UserOrdersComponent_div_17_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.prevPage());\n    });\n    i0.ɵɵtext(2, \"Previous\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"span\", 25);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function UserOrdersComponent_div_17_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.nextPage());\n    });\n    i0.ɵɵtext(6, \"Next\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.currentPage === 1);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\"Page \", ctx_r0.currentPage, \" of \", ctx_r0.totalPages, \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.currentPage === ctx_r0.totalPages);\n  }\n}\nfunction UserOrdersComponent_p_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 26);\n    i0.ɵɵtext(1, \"No orders found.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let UserOrdersComponent = /*#__PURE__*/(() => {\n  class UserOrdersComponent {\n    orders = [];\n    errorMessage = '';\n    selectedStatus = '';\n    filteredOrders = [];\n    paginatedOrders = [];\n    currentPage = 1;\n    pageSize = 5; // Number of orders per page\n    totalPages = 1;\n    orderService = inject(OrderService);\n    router = inject(Router);\n    oidcSecurityService = inject(OidcSecurityService);\n    ngOnInit() {\n      this.loadUserCart();\n    }\n    loadUserCart() {\n      this.oidcSecurityService.getAccessToken().subscribe(token => {\n        const userId = this.decodeToken(token); // Get the current user ID\n        this.orderService.getOrdersByUserId(userId).subscribe({\n          next: orders => {\n            console.log('Orders fetched:', orders);\n            this.orders = orders;\n            this.filterOrders();\n          },\n          error: error => {\n            this.errorMessage = 'Failed to load orders. Please try again later.';\n            console.error('Error fetching orders:', error);\n          }\n        });\n      }, error => {\n        console.error('Failed to get access token:', error);\n      });\n    }\n    cancellOrder(order) {\n      const updatedOrder = {\n        ...order,\n        status: 'CANCELLED'\n      }; // Assign the new status\n      this.orderService.updateOrderStatus(updatedOrder).subscribe({\n        next: () => {\n          alert('Order was cancelled');\n          // Update the status in the local orders array\n          const index = this.orders.findIndex(o => o.id === order.id);\n          if (index !== -1) {\n            this.orders[index].status = 'CANCELLED';\n          }\n          // Reapply filters and pagination to reflect the updated status\n          this.filterOrders();\n        },\n        error: error => {\n          console.error('Failed to cancell order:', error);\n          this.errorMessage = 'Failed to cancell order.';\n        }\n      });\n    }\n    filterOrders() {\n      if (!this.selectedStatus) {\n        this.filteredOrders = this.orders; // Show all orders if no filter is selected\n      } else {\n        this.filteredOrders = this.orders.filter(order => order.status === this.selectedStatus);\n      }\n      this.paginateOrders(); // Re-apply pagination whenever the filter changes\n    }\n    paginateOrders() {\n      const start = (this.currentPage - 1) * this.pageSize;\n      const end = start + this.pageSize;\n      this.paginatedOrders = this.filteredOrders.slice(start, end);\n      this.totalPages = Math.ceil(this.filteredOrders.length / this.pageSize); // Calculate the total pages\n    }\n    // Pagination navigation functions\n    prevPage() {\n      if (this.currentPage > 1) {\n        this.currentPage--;\n        this.paginateOrders(); // Re-apply pagination on page change\n      }\n    }\n    nextPage() {\n      if (this.currentPage < this.totalPages) {\n        this.currentPage++;\n        this.paginateOrders(); // Re-apply pagination on page change\n      }\n    }\n    openOrderDetails(orderId) {\n      this.router.navigate(['/order-details', orderId]); // Adjust the route as necessary\n    }\n    decodeToken(token) {\n      try {\n        const base64Url = token.split('.')[1];\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n        const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));\n        const decoded = JSON.parse(jsonPayload);\n        return decoded.sub || decoded.userId || null; // Adjust according to your JWT structure\n      } catch (error) {\n        console.error('Failed to decode token:', error);\n        return null;\n      }\n    }\n    static ɵfac = function UserOrdersComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || UserOrdersComponent)();\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: UserOrdersComponent,\n      selectors: [[\"app-user-orders\"]],\n      standalone: true,\n      features: [i0.ɵɵStandaloneFeature],\n      decls: 19,\n      vars: 5,\n      consts: [[1, \"container\", \"mx-auto\", \"p-4\"], [1, \"text-3xl\", \"font-bold\", \"mb-4\"], [\"class\", \"alert alert-danger mb-4\", 4, \"ngIf\"], [1, \"mb-4\"], [\"for\", \"statusFilter\", 1, \"block\", \"text-sm\", \"font-semibold\", \"mb-2\"], [\"id\", \"statusFilter\", 1, \"border\", \"rounded\", \"px-2\", \"py-1\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"value\", \"\"], [\"value\", \"NEW\"], [\"value\", \"DELIVERED\"], [\"value\", \"CANCELLED\"], [\"class\", \"card border rounded shadow-lg p-4 mb-4 transition-transform transform hover:scale-105\", 3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"flex justify-center mt-4\", 4, \"ngIf\"], [\"class\", \"text-gray-500\", 4, \"ngIf\"], [1, \"alert\", \"alert-danger\", \"mb-4\"], [1, \"card\", \"border\", \"rounded\", \"shadow-lg\", \"p-4\", \"mb-4\", \"transition-transform\", \"transform\", \"hover:scale-105\", 3, \"ngClass\"], [1, \"flex\", \"justify-between\", \"items-center\", \"mb-3\"], [1, \"text-lg\", \"font-semibold\", \"text-gray-800\"], [1, \"text-info\"], [1, \"badge\", 3, \"ngClass\"], [\"class\", \"flex items-center mt-4\", 4, \"ngIf\"], [1, \"mt-2\", \"text-blue-500\", \"underline\", 3, \"click\"], [1, \"flex\", \"items-center\", \"mt-4\"], [1, \"bg-red-500\", \"text-white\", \"px-4\", \"py-2\", \"rounded-lg\", \"ml-2\", 3, \"click\"], [1, \"flex\", \"justify-center\", \"mt-4\"], [1, \"bg-gray-300\", \"text-black\", \"px-4\", \"py-2\", \"rounded-lg\", 3, \"click\", \"disabled\"], [1, \"mx-2\"], [1, \"text-gray-500\"]],\n      template: function UserOrdersComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\", 1);\n          i0.ɵɵtext(2, \"Orders List\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(3, UserOrdersComponent_div_3_Template, 4, 1, \"div\", 2);\n          i0.ɵɵelementStart(4, \"div\", 3)(5, \"label\", 4);\n          i0.ɵɵtext(6, \"Filter by Status\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"select\", 5);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function UserOrdersComponent_Template_select_ngModelChange_7_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.selectedStatus, $event) || (ctx.selectedStatus = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"change\", function UserOrdersComponent_Template_select_change_7_listener() {\n            return ctx.filterOrders();\n          });\n          i0.ɵɵelementStart(8, \"option\", 6);\n          i0.ɵɵtext(9, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"option\", 7);\n          i0.ɵɵtext(11, \"NEW\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"option\", 8);\n          i0.ɵɵtext(13, \"DELIVERED\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"option\", 9);\n          i0.ɵɵtext(15, \"CANCELLED\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(16, UserOrdersComponent_div_16_Template, 20, 17, \"div\", 10)(17, UserOrdersComponent_div_17_Template, 7, 4, \"div\", 11)(18, UserOrdersComponent_p_18_Template, 2, 0, \"p\", 12);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.selectedStatus);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngForOf\", ctx.paginatedOrders);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.filteredOrders.length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.filteredOrders.length === 0);\n        }\n      },\n      dependencies: [CommonModule, i1.NgClass, i1.NgForOf, i1.NgIf, i1.DecimalPipe, FormsModule, i2.NgSelectOption, i2.ɵNgSelectMultipleOption, i2.SelectControlValueAccessor, i2.NgControlStatus, i2.NgModel],\n      styles: [\".bg-red-200[_ngcontent-%COMP%]{background-color:#fed7d7}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.badge-danger[_ngcontent-%COMP%]{color:#fff;background-color:red}\"]\n    });\n  }\n  return UserOrdersComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}